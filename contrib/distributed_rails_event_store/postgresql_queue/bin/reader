#!/usr/bin/env ruby

require "bundler/setup"
require "postgresql_queue"

require 'rspec'
require_relative '../spec/spec_helper.rb'
require 'pry'

include SchemaHelper
establish_database_connection

client = RubyEventStore::Client.new(repository: DistributedRepository.new)

class MyEvent < RubyEventStore::Event
end

reader = PostgresqlQueue::Reader.new(client)
last = :head
1.step do |ite|
  # puts ite
  events = reader.events(after_event_id: last)
  events.each do |e|
    puts e.data.merge({event_id: e.event_id[0..7]})
    last = e.event_id
  end
  # puts "-- #{events.size}"
end